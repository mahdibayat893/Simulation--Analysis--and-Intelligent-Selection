import numpy as np
from scipy.spatial import distance

# Pump catalogue 


pumps = [
    {
        "model": "ETA_32-125",
        "Q": [3.03, 6.49, 8.71, 13.56, 15.26, 19.80, 23.75, 25.00],
        "H": [15.86, 21.59, 13.93, 10.03, 25.23, 10.03, 13.61, 12.00],
        "eff_curve": [
            (11.97, 23.28, 60), (13.26, 22.65, 62), (15.84, 22.65, 62), (19.88, 19.53, 63.5)
        ],
        "impellers": {
            110: [(0.0, 15.91), (14.69, 8.34)],
            115: [(0.17, 17.37), (16.67, 8.99)],
            120: [(0.08, 18.80), (18.32, 9.50)],
            125: [(0.03, 20.49), (20.17, 10.13)],
            130: [(0.00, 22.05), (21.82, 11.08)],
        }
    },
    {
        "model": "ETA_32-160",
        "Q": [3.06, 3.07, 4.03, 4.47, 6.98, 10.0, 11.88, 18.95, 25.20],
        "H": [25.39, 39.34, 39.34, 25.48, 39.47, 24.24, 39.21, 18.97, 29.88],
        "eff_curve": [
            (8.53, 39.23, 50), (10.5, 39.03, 55), (12.7, 38.32, 58),
            (14.89, 35.11, 60), (17.76, 28.58, 62), (19.88, 34.76, 63.5)
        ],
        "impellers": {
            130: [(0.07, 23.26), (19.40, 12.22)],
            140: [(0.07, 27.23), (22.60, 13.72)],
            150: [(0.04, 31.24), (25.39, 16.44)],
            160: [(0.0, 35.91), (28.78, 19.35)],
            169: [(0.04, 39.78), (31.28, 21.35)],
        }
    },
    {
        "model": "ETA_40-160",
        "Q": [12.17, 18.85, 21.22, 25.32, 31.75, 32.70, 39.41],
        "H": [39.34, 38.57, 22.76, 30.07, 32.57, 17.75, 23.22],
        "eff_curve": [
            (12.89, 38.98, 50), (15.73, 34.38, 55), (18.63, 38.52, 60),
            (21.90, 28.49, 64), (24.07, 33.14, 66), (29.11, 34.76, 67.5)
        ],
        "impellers": {
            130: [(0.16, 23.33), (22.72, 15.31)],
            140: [(0.12, 26.99), (26.04, 16.03)],
            150: [(0.12, 30.84), (32.14, 18.03)],
            160: [(0.94, 35.36), (37.42, 19.19)],
            169: [(0.12, 39.41), (41.96, 21.57)]
        }
    },
    {
        "model": "ETA_40-200",
        "Q": [25.87, 33.79, 43.90, 52.38, 62.43, 66.53, 57.81, 43.01, 33.91, 23.70, 13.77, 19.53, 25.03],
        "H": [35.00, 34.43, 32.15, 29.89, 26.80, 23.75, 18.84, 15.61, 14.76, 15.07, 15.78, 21.63, 28.24],
        "eff_curve": [
            (19.74, 15.89, 50), (21.61, 18.72, 55), (23.45, 21.33, 58),
            (27.88, 24.90, 60), (31.75, 29.10, 62), (34.89, 33.30, 63.5),
            (39.21, 34.76, 65), (45.12, 31.72, 68), (52.17, 28.10, 70)
        ],
        "impellers": {
            160: [(0.0, 15.97), (28.78, 14.27), (46.33, 13.09), (59.98, 11.35)],
            170: [(0.0, 17.87), (19.03, 17.64), (38.35, 16.34), (52.27, 15.04), (60.45, 13.54), (68.06, 11.90)],
            180: [(0.37, 20.03), (19.31, 19.86), (40.30, 18.68), (52.92, 17.54), (64.07, 16.15), (76.60, 13.51)],
            190: [(0.0, 22.33), (21.45, 22.07), (40.76, 20.73), (54.13, 19.53), (67.78, 17.78), (75.58, 16.34), (83.94, 14.25)],
            200: [(0.0, 24.65), (27.76, 24.10), (44.20, 22.83), (60.17, 21.19), (77.53, 18.72), (92.39, 15.45)]
        }
    },
    {
        "model": "ETA_50-125",
        "Q": [24.23, 33.85, 41.65, 47.14, 52.93, 55.83, 45.67, 33.90, 26.72, 20.43, 14.13, 19.81, 23.95],
        "H": [25.12, 24.08, 21.85, 20.23, 18.10, 16.52, 13.38, 11.42, 10.71, 11.67, 13.27, 17.60, 21.03],
        "eff_curve": [
            (17.34, 14.29, 50), (19.22, 16.77, 55), (21.42, 19.50, 58),
            (25.84, 22.43, 60), (29.73, 23.78, 62), (32.81, 24.69, 63.5),
            (36.19, 23.96, 65), (40.17, 21.60, 68), (44.72, 19.50, 70)
        ],
        "impellers": {
            120: [(0.0, 11.13), (20.23, 9.57), (36.98, 7.83)],
            125: [(0.0, 12.78), (24.09, 11.34), (39.34, 9.52)],
            130: [(0.0, 14.48), (27.12, 13.08), (41.99, 11.35)],
            135: [(0.0, 16.04), (30.41, 14.68), (45.05, 13.10)],
            139: [(0.0, 17.43), (33.87, 16.23), (47.32, 14.59)]
        }
    },
    {
        "model": "ETA_50-160",
        "Q": [37.16, 41.00, 49.66, 63.18, 71.80, 82.80],
        "H": [35.50, 35.38, 34.57, 31.60, 28.90, 24.98],
        "eff_curve": [

            (10.70, 23.88, 59), (12.02, 23.28, 60), (13.26, 22.65, 62),
            (16.38, 22.65, 62), (19.88, 19.53, 63.5)
        ],
        "impellers": {
            130: [(0.22, 21.57), (11.04, 21.64), (19.63, 21.29)],
            140: [(0.45, 24.94), (9.85, 24.97), (18.43, 24.79)],
            150: [(0.22, 28.62), (13.50, 28.58), (27.01, 28.19)],
            160: [(0.0, 32.45), (14.62, 32.37), (27.08, 32.12)]
        }
    },
    {
        "model": "ETA_50-200",
        "Q": [37.34, 49.90, 64.12, 72.15, 81.99, 87.40, 71.45, 53.20, 41.20, 30.23, 19.51, 27.94, 33.84],
        "H": [35.50, 34.45, 31.30, 29.38, 35.73, 40.13, 48.97, 54.45, 56.29, 57.61, 58.19, 50.96, 42.74],
        "eff_curve": [
            (23.21, 57.52, 50), (21.73, 51.27, 50), (20.15, 45.57, 50), (18.29, 38.03, 50),
            (27.95, 57.32, 55), (26.56, 51.12, 55), (25.26, 45.81, 55), (22.66, 37.28, 55),
            (34.54, 56.83, 60), (32.13, 49.98, 60), (30.08, 44.03, 60), (27.11, 36.79, 60),
            (41.60, 55.88, 65), (37.33, 46.31, 65), (33.05, 36.04, 65), (90.99, 38.62, 65),
            (75.30, 31.88, 65), (58.77, 26.37, 65),
            (48.00, 54.94, 68), (42.15, 45.12, 68), (39.83, 34.65, 68), (54.22, 29.35, 68),
            (72.24, 34.36, 68), (87.56, 41.10, 68),
            (53.02, 54.20, 70), (48.00, 45.57, 70), (72.79, 38.72, 70), (49.58, 34.16, 70), (83.10, 43.58, 70),
            (60.35, 52.41, 72), (56.55, 47.70, 72), (57.66, 41.20, 72), (70.19, 43.13, 72), (77.16, 46.51, 72),
            (67.97, 49.29, 73)
        ],
        "impellers": {
            170: [(0.0, 37.83), (28.78, 36.54), (46.33, 32.57), (59.98, 25.23)],
            180: [(0.0, 42.89), (19.03, 42.54), (38.35, 40.21), (52.27, 36.54), (60.45, 32.82), (68.06, 27.96)],
            190: [(0.37, 47.80), (19.31, 47.55), (40.30, 45.27), (52.92, 42.44), (64.07, 38.32), (76.60, 30.78)],
            200: [(0.0, 53.01), (21.45, 52.66), (40.76, 51.02), (54.13, 48.14), (67.78, 43.83), (75.58, 40.06), (83.94, 34.26)],
            209: [(0.0, 57.97), (27.76, 57.32), (44.20, 55.68), (60.17, 52.61), (77.53, 46.46), (92.39, 37.43)]
        }
    }
]

try:
    Q_req = float(input("Flow rate (m3/h): "))
    H_req = float(input("Head (m): "))
except ValueError:
    raise SystemExit("Numeric input required.")

if Q_req >= 40 or H_req >= 40:
    raise SystemExit("Both Q and H must be below 40 (project spec).")

rho, g = 1000, 9.81
best, best_score = None, float('inf')

for p in pumps:
    Qs, Hs = np.array(p["Q"]), np.array(p["H"])
    order = np.argsort(Qs)
    Qs, Hs = Qs[order], Hs[order]

    if Q_req < Qs[0] or Q_req > Qs[-1]:
        continue

    H_interp = np.interp(Q_req, Qs, Hs)
    if H_interp < H_req:
        continue

    eff_pts  = np.array([(q, h) for q, h, _ in p["eff_curve"]])
    eff_vals = np.array([e for _, _, e in p["eff_curve"]])
    e_idx    = np.argmin(distance.cdist([[Q_req, H_interp]], eff_pts)[0])
    eta      = eff_vals[e_idx]/100.0

    best_dia, err_imp = None, float('inf')
    for dia, curve in p["impellers"].items():
        cQ = np.array([q for q, _ in curve])
        cH = np.array([h for _, h in curve])
        ord2 = np.argsort(cQ)
        cQ, cH = cQ[ord2], cH[ord2]
        if Q_req < cQ[0] or Q_req > cQ[-1]:
            continue
        Himp = np.interp(Q_req, cQ, cH)
        err  = abs(Himp - H_req)
        if err < err_imp:
            err_imp, best_dia = err, dia

    if best_dia is None:
        continue

    score = abs(H_interp - H_req)/H_req - 0.01*eta
    if score < best_score:
        best_score = score
        best = dict(model=p["model"], Q=Q_req, H=H_interp, eta=eta, imp=best_dia)

if best is None:
    print("No suitable pump found.")
else:
    P_kw = (best["Q"]*best["H"]*rho*g)/(best["eta"]*3600*1000)
    print(f"\nSelected pump:   {best['model']}")
    print(f"Operating Q/H:   {best['Q']:.2f} m3/h  |  {best['H']:.2f} m")
    print(f"Efficiency:      {best['eta']*100:.1f} %")
    print(f"Impeller Ã˜:      {best['imp']} mm")
    print(f"Power (shaft):   {P_kw:.2f} kW")
